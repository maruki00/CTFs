#!/usr/bin/env python

import socket
import subprocess

s = socket.create_connection(('52.69.244.164', 9003))

def recv_until(st):
  buf = ''
  while st not in buf:
    buf += s.recv(1)
  return buf

print recv_until("begins with ")
salt = map(lambda x:int(x,16),recv_until(",")[:-1].split())

#offload proof of work to not be python...
proof = subprocess.check_output(["./sha.sh", str(salt[0]+256*salt[1]+65536*salt[2]+16777216*salt[3])]).strip()
recv_until("zero? ")

s.send(''.join(map(chr, salt))+proof.decode("hex"))

p = 195589859419604305972182309315916027436941011486827038011731627454673222943892428912238183097741291556130905026403820602489277325267966860236965344971798765628107804393049178848883490619438682809554522593445569865108465536075671326806730534242861732627383004696136244305728794347161769919436748766859796527723L
#big factor of p-1
f = 4759647095086827597559114855685975263112106458932414012998147177848303887783492510354911068366203455488902018600593880874117783509946030773587965941L

s.send(str(pow(2, f*(3**30), p)).strip("L")+"\n")
print s.recv(1024)

#in pari/gp
# g = Mod(148975044697327694167827849361675361671139902431323999362656816860370248534475636133131142428319545513396821528814917224329094758494204269481642209003834226508257688981368168757186146929714158578868311565720386826122343208169715616305157207182525469870885124399553434467057677305837734782632264760454683085733L, p)
# a = [response]
# znlog(a, g, 2*3^306)
# get 1053194137440650777245209179832422069277215965401386954507182362226896709188340544607528308817298833089231689626065710717
# hex(1053194137440650777245209179832422069277215965401386954507182362226896709188340544607528308817298833089231689626065710717)[2:-1].decode("hex")
