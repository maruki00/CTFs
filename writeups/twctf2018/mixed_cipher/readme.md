## Mixed Cipher - Crypto Challenge - Writeup by Samuel Kim (@ubuntor)

### Description

We have a network service where we can get the flag encrypted with AES
with the IV thrown away and the AES key encrypted with RSA.

We can query AES and RSA encryptions, and RSA decryptions with only the least
significant byte of the output.

### Solution

We first need to recover the AES key. We have the AES key encrypted with RSA.

We can decrypt RSA, but we only get the least significant byte of the output.

We can use this to decrypt the whole AES key by an RSA LSB oracle, but first we
need to recover `N`, the modulus.

#### Recovering N
We can recover `N` by computing `m^e - encrypt_RSA(m)` for various `m` an
taking the gcd of all of them.

#### RSA LSB Oracle
We follow [https://crypto.stackexchange.com/questions/11053/rsa-least-significant-bit-oracle-attack](https://crypto.stackexchange.com/questions/11053/rsa-least-significant-bit-oracle-attack) to decrypt the AES key given the least significant bit from RSA decryption.

#### Recovering IV

Now we can decrypt the flag with the recovered AES key. Unfortunately, the
encrypted flag has the IV thrown away, so the first 16 bytes of the decrypted
flag are mangled.

However, the IVs are generated by `random.getrandbits(128)`. Note that python
uses the Mersenne Twister, so each IV comes from 4 outputs of the Mersenne
Twister.

Then we can recover its state by getting AES encryptions `624/4` times, gathering
IVs and cloning the RNG with [https://github.com/jaybosamiya/matasano-crypto/blob/master/set3/mersennetwister.py](https://github.com/jaybosamiya/matasano-crypto/blob/master/set3/mersennetwister.py) (thanks @jaybosamiya!)

We can then request the encrypted flag, compute the IV, and decrypt.

Solution script in [solve.py](solve.py)
